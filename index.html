<!DOCTYPE html>
<html>
<head>
  <script>
    window.GLOBAL_CONFIG = {
      SCF_GATEWAY: `https://dark.ananno-sakib.workers.dev/`,
      SITE_NAME: `SakFi 's Media Server`,
      IS_BUSINESS: false,
      PRELOAD: false,
    };

    document.addEventListener('DOMContentLoaded', () => {
      document.title = window.GLOBAL_CONFIG.SITE_NAME;
      document.querySelector('.site').textContent = window.GLOBAL_CONFIG.SITE_NAME;

      const fileList = document.getElementById('file-list');

      // Attach right-click event listener
      fileList.addEventListener('contextmenu', (event) => {
        event.preventDefault();

        // Remove any existing menu
        const existingMenu = document.querySelector('.context-menu');
        if (existingMenu) existingMenu.remove();

        // Check if right-clicked on a file row
        const fileWrapper = event.target.closest('.file-wrapper');
        if (fileWrapper) {
          const menu = document.createElement('div');
          menu.className = 'context-menu';
          menu.style.top = `${event.pageY}px`;
          menu.style.left = `${event.pageX}px`;

          const fileUrl = fileWrapper.dataset.fileUrl;
          const fileName = fileWrapper.querySelector('.name').textContent.trim();

          menu.innerHTML = `
            <div class="menu-item" onclick="downloadFile('${fileUrl}')">Download</div>
            <div class="menu-item" onclick="renameFile('${fileName}', '${fileWrapper.dataset.filePath}')">Rename</div>
            <div class="menu-item" onclick="deleteFile('${fileWrapper.dataset.filePath}')">Delete</div>
          `;

          document.body.appendChild(menu);

          // Remove the menu on click outside
          document.addEventListener('click', () => {
            menu.remove();
          }, { once: true });
        }
      });
    });

    function downloadFile(url) {
      const link = document.createElement('a');
      link.href = url;
      link.download = '';
      link.click();
    }

    function renameFile(currentName, filePath) {
      const newName = prompt(`Rename file "${currentName}" to:`, currentName);
      if (newName && newName !== currentName) {
        sendRequest(
          'POST',
          `${window.GLOBAL_CONFIG.SCF_GATEWAY}rename`,
          JSON.stringify({ path: filePath, newName }),
          { 'Content-Type': 'application/json' },
          () => {
            alert(`File renamed to "${newName}" successfully.`);
            location.reload(); // Reload to reflect changes
          },
          () => alert('Failed to rename file.')
        );
      }
    }

    function deleteFile(filePath) {
      if (confirm(`Are you sure you want to delete this file?`)) {
        sendRequest(
          'POST',
          `${window.GLOBAL_CONFIG.SCF_GATEWAY}delete`,
          JSON.stringify({ path: filePath }),
          { 'Content-Type': 'application/json' },
          () => {
            alert(`File deleted successfully.`);
            location.reload(); // Reload to reflect changes
          },
          () => alert('Failed to delete file.')
        );
      }
    }

    function sendRequest(method, url, data, headers, successCallback, errorCallback) {
      const xhr = new XMLHttpRequest();
      xhr.open(method, url, true);
      xhr.onreadystatechange = () => {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            successCallback(xhr.responseText);
          } else {
            errorCallback(xhr.responseText);
          }
        }
      };
      if (headers) {
        for (const key in headers) {
          if (headers.hasOwnProperty(key)) {
            xhr.setRequestHeader(key, headers[key]);
          }
        }
      }
      xhr.send(data);
    }
  </script>
  <style>
    /* General Styles */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #ffffff;
    }

    .header {
      background-color: #1c1c1c;
      padding: 1em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #333;
    }

    .header .site {
      font-size: 1.5em;
      font-weight: bold;
      color: #00d1b2;
    }

    .container {
      display: flex;
      height: calc(100vh - 3em);
    }

    .left {
      background-color: #1c1c1c;
      width: 20%;
      padding: 1em;
      overflow-y: auto;
      border-right: 1px solid #333;
    }

    .right {
      flex-grow: 1;
      padding: 1em;
      overflow-y: auto;
    }

    .file-wrapper {
      padding: 0.5em 1em;
      border: 1px solid #333;
      margin-bottom: 0.5em;
      background-color: #1e1e1e;
      border-radius: 4px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .file-wrapper:hover {
      background-color: #272727;
    }

    .file i {
      font-size: 1.2em;
      margin-right: 1em;
      color: #00d1b2;
    }

    .name {
      font-weight: bold;
      flex-grow: 1;
    }

    .context-menu {
      position: absolute;
      background: #1c1c1c;
      border: 1px solid #333;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      color: #ffffff;
      border-radius: 4px;
    }

    .menu-item {
      padding: 8px 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .menu-item:hover {
      background-color: #333;
    }

    .btn {
      background-color: #00d1b2;
      color: #fff;
      border: none;
      padding: 0.5em 1em;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .btn:hover {
      background-color: #00bfa5;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="site">SakFi's Media Server</div>
  </div>
  <div class="container">
    <div class="left">
      <div id="tree-root">
        <!-- Left panel content (if any) -->
      </div>
    </div>
    <div class="right">
      <div id="file-list">
        <!-- Example Files -->
        <div class="file-wrapper" data-file-url="https://example.com/file1.txt" data-file-path="/folder1/file1.txt">
          <div class="file">
            <i class="zmdi zmdi-file"></i>
            <span class="name">file1.txt</span>
          </div>
        </div>
        <div class="file-wrapper" data-file-url="https://example.com/file2.txt" data-file-path="/folder1/file2.txt">
          <div class="file">
            <i class="zmdi zmdi-file"></i>
            <span class="name">file2.txt</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
